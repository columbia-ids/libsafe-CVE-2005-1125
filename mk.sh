#!/usr/bin/env bash

# Clean up previous builds
rm -vrf libsafe-2.0-16

# Get and build libsafe 2.0-16
[ ! -f libsafe-2.0-16.tgz ] && wget http://pubs.research.avayalabs.com/src/libsafe-2.0-16.tgz
tar -xvf libsafe-2.0-16.tgz
pushd libsafe-2.0-16
make
popd

# Compile the proof of concept exploit
gcc -o thread thread.c -fno-builtin -lpthread

# Generate interpose.c
#python gen_interpose.py

# Compile the library interposition code
gcc -shared -ldl -fPIC -fno-builtin interpose.c -o interpose.so

