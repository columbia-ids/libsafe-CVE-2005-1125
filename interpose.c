/* Libsafe function interposition with inspiration from
 * http://jayconrod.com/posts/23/tutorial-function-interposition-in-linux
 */

#define _GNU_SOURCE
#include <stdio.h>
#include <dlfcn.h>
#include <time.h>

size_t strnlen(const char *s, size_t maxlen)
{
	static size_t (*real_strnlen)(const char *, size_t) = NULL;
	struct timespec req = {(time_t) 0, (long) 1000};

	nanosleep(&req, NULL);
	if(!real_strnlen)
		real_strnlen = dlsym(RTLD_NEXT, "strnlen");
	return real_strnlen(s, maxlen);
}
